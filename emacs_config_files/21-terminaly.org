* Terminaly

#+begin_src emacs-lisp
;; terminaly.el -*- lexical-binding: t; -*-

;; Konfigurace pro vestavene terminaly v Emacsu
;; ---------------------------------------------
;; Tento soubor obsahuje nastaveni pro term, vterm a eshell,
;; coz jsou ruzne terminalove emulatory primo v Emacsu.

;; Term - vestaveny terminal
;; --------------------------
;; Je uzitecnym fallbackem, kdyz ostatni terminaly nefunguji spravne.
(use-package term
  :config
  ;; Pouzije bash jako vychozi shell.
  (setq explicit-shell-file-name "bash")
  ;; Nastavi regulerni vyraz pro rozpoznani promptu.
  (setq term-prompt-regexp "^[^#$%>\n]*[#$%>] *"))

;; Eterm-256color
;; ---------------
;; Zajisti podporu 256 barev v term bufferu.
(use-package eterm-256color
  :hook (term-mode . eterm-256color-mode))

;; Vterm - lepsi terminal
;; -----------------------
;; vterm je rychlejsi, modernejsi a plne funkcni terminal,
;; ktery podporuje vice funkci nez term.
(use-package vterm
  :commands vterm
  :config
  ;; Nastavi regulerni vyraz pro rozpoznani promptu.
  (setq term-prompt-regexp "^[^#$%>\n]*[#$%>] *")
  ;; Nastavi maximalni velikost scrollback bufferu.
  (setq vterm-max-scrollback 10000))

;; Eshell - terminal psany v Emacs Lispu
;; --------------------------------------
;; eshell je terminal, ktery je plne integrovany s Emacsem.
;; Umoznuje pouzivat jak terminalove prikazy, tak Emacs funkce.
(defun jsp/configure-eshell ()
  ;; Uklada historii prikazu.
  (add-hook 'eshell-pre-command-hook 'eshell-save-some-history)
  ;; Umozni zkraceni bufferu pro lepsi vykon.
  (add-to-list 'eshell-output-filter-functions 'eshell-truncate-buffer)

  ;; Klavesove zkratky pro eshell.
  (evil-define-key '(normal insert visual) eshell-mode-map (kbd "C-r") 'counsel-esh-history)
  (evil-define-key '(normal insert visual) eshell-mode-map (kbd "<home>") 'eshell-bol)
  (evil-normalize-keymaps)

  ;; Nastaveni historie a chovani bufferu.
  (setq eshell-history-size             10000
        eshell-buffer-maximum-lines     10000
        eshell-hist-ignoredups          t
        eshell-scroll-to-bottom-on-input t))

(use-package eshell-git-prompt)

(use-package eshell
  :hook (eshell-first-time-mode . jsp/configure-eshell)
  :config
  (with-eval-after-load 'esh-opt
    (setq eshell-destroy-buffer-when-process-dies t)
    ;; Prikazy, ktere maji byt spusteny v externim terminalu.
    (setq eshell-visual-commands '("htop" "zsh" "vim")))
  ;; Pouzije tema pro git prompt.
  (eshell-git-prompt-use-theme 'powerline))


(provide 'terminaly)

;; terminaly.el ends here
#+end_src
